<!DOCTYPE html>
<html>
<head>
    <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>
<style type="text/css">

body{
  background-color: #333333;

}

#head{
  height: 50px;
display: block;
  background-color: #1aa0e0;
margin-top: -8px;
width: 100%;
margin-left: auto;
margin-right: auto;
border-bottom-right-radius: 5px;
border-bottom-left-radius: 5px;
left: 0;
 border-bottom: 2px solid white;
 border-left: 2px solid white;
 border-right: 2px solid white;


}



#headerlogo{


margin-top: -30px;
margin-left: -30px;


}



#footer{

position: fixed;
left: 10px;
bottom: 0;
height: 30px;
width: 98.2%;
background-color: #1aa0e0;
color: white;
text-align: center;
border-top: 2px solid white;
border-left: 2px solid white;
border-right: 2px solid white;
border-top-right-radius: 5px;
border-top-left-radius: 5px;
font-size: 20px;

}

#ftext{
  font-family: sans-serif;
  margin-top: 5px;
}

#signupforms{
  height: 620px;
  width: 500px;
  margin-left: auto;
  margin-right: auto;
  background-color: white;
  margin-top: 10px;
}



</style>
<script type="text/javascript">
function login(){
    var email = document.getElementById("logus").value;

    var pass = document.getElementById("logpass").value;

    firebase.auth().signInWithEmailAndPassword(email, pass).catch(function(error) {
    // Handle Errors here.
    var errorCode = error.code;
    var errorMessage = error.message;
    // ...
  });

  firebase.auth().onAuthStateChanged(function(user) {
    if (user) {

   window.location.href = "freeagents.htm";


    }

  });

  }



    function register(){
    var firebaseref = firebase.database().ref();
    var email = document.getElementById("regemail").value;
    var pass = document.getElementById("regpss").value;
    var username = document.getElementById("regus").value;
    var database = firebase.database();
    var isSuccessful = false;

            var pword = document.getElementById("regpss").value;


  if(username =="")
  {
    alert("Please enter a username");
  }
  else if(email == "")
  {
    alert("Please enter an email");
  }
  else {


//check database for already existing username

var checkusername = false;
var checkemail = false;
  database.ref('/Users/').once('value', function(snap) {
    var fa = [];
    snap.forEach(function(item) {
var ch = item.val();
      if(username.toLowerCase() == ch.name.toLowerCase())
      {
        checkusername = true;
      }

      if(email.toLowerCase() == ch.email.toLowerCase())
      {
        checkemail = true;
      }


    })


    if(checkusername == true)
    {
        alert("Username has already been taken");
    }
    else if(checkemail == true)
    {
      alert("Email has already been used");
    }
    else{


        firebase.auth().createUserWithEmailAndPassword(email, pass).catch(function(error) {  // Handle Errors here.
        var errorCode = error.code;
        var errorMessage = error.message;
        });

        firebase.auth().onAuthStateChanged(function(user) {
          if (user) {
            usersRef = firebaseref.child(user.uid);
            firebase.database().ref('Users/' + username).set({
              email: email,
              pic: "https://firebasestorage.googleapis.com/v0/b/poctest-c1a05.appspot.com/o/img_191958.png?alt=media&token=88088937-bbfe-43ad-8b7e-1e521579a758",
              id: user.uid,
              name: username,

            });

            var ch = user.uid;
            firebase.database().ref(user.uid).set({
             name: username,
             email: email,
             money: 0,
             xp: 0,
             Earnings: 0,
             TryLs: 0,
             XBL: "",
             PSN: "",
             pic: "https://firebasestorage.googleapis.com/v0/b/poctest-c1a05.appspot.com/o/img_191958.png?alt=media&token=88088937-bbfe-43ad-8b7e-1e521579a758",
             twitter: "",
             freeagentstatus: true,
             Role: "",
           });

      firebase.database().ref(user.uid + '/Following/' + user.uid).update({ch});
      isSuccessful = true;

      setTimeout(function () {
      changepage();
      }, 2000);

          }
          });


      }

  });





}
    }


  function changepage(){
 window.location.href = "index.htm";

  }

  function pagesetup(){
    var database = firebase.database();
        firebase.auth().onAuthStateChanged(function(user) {
          if (user) {
            // User is signed in.
      //    window.location.href = "index.htm";
          }
          else{
          //  window.location.href = "index.htm";
          }
        })



  }


</script>


</head>
<body onload="pagesetup();">
<div id="head">


<center>

    <img id="headerlogo" src="Images/ngelogo.png" height="110px" width="110px" />

</center>

</div>

<div id="signupforms">
  <center>
    <br />  <br />
    <h1> Welcome </h1>
    <br />  <br />
      <h2> Login </h2>

      <input class="button" id ="logus" placeholder="Username">  <br /><br />
      <input class="button" id ="logpass" placeholder="Password">  <br /><br />
      <button onclick="login();">Login</button><br />
      <h2>Register </h2>
      <input class="button" id ="regemail" placeholder="Email">  <br /><br />
      <input class="button" id ="regus" placeholder="Username">  <br /><br />
      <input class="button" id ="regpss" placeholder="Password">  <br /><br />
      <button onclick="register();">Register</button><br />


</div>


 <div id="footer"><!--
  <div id="ftext">
  Privacy Policy &nbsp&nbsp&nbsp
  Terms of Service &nbsp&nbsp&nbsp
  Advertise &nbsp&nbsp&nbsp
  Contact Us
</div>
-->

</div>
  <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyCQtXd25fQmP_6zV-mxSs64O_9y2J20iI4",
      authDomain: "poctest-c1a05.firebaseapp.com",
      databaseURL: "https://poctest-c1a05.firebaseio.com",
      projectId: "poctest-c1a05",
      storageBucket: "poctest-c1a05.appspot.com",
      messagingSenderId: "434071952145"
    };
    firebase.initializeApp(config);
    </script>
</body>


</html>
