<!-- All code written on this site is sole property of National Gaming Events
Developer: Allen Olsen Kendrick (zNine) Twitter @MoazNine
 Version Number='0.0.0.0.6'
 Version Update='0'
 Version Name = 'AfterMath'
 Version Publish Date = '04-29-2018'
Developer Notes: -->

<!DOCTYPE html>
<html>
<head>
    <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>
<style type="text/css">

body{
  background-color: #333333;

}

#head{
  height: 50px;
display: block;
  background-color: #1aa0e0;
margin-top: -8px;
width: 100%;
margin-left: auto;
margin-right: auto;
border-bottom-right-radius: 5px;
border-bottom-left-radius: 5px;
left: 0;
 border-bottom: 2px solid white;
 border-left: 2px solid white;
 border-right: 2px solid white;


}

#username{
  color: white;
  margin-left: 20px;
  float: left;
  padding-top: 10px;
  font-size: 30px;
  font-family: sans-serif;
  display: block;
}

#headerlogo{


margin-top: -30px;
margin-left: -30px;


}

#menu{
  border-radius: 100px;
  margin-top: -80px;
  float: right;
  margin-right: 40px;

}

#footer{

position: fixed;
left: 10px;
bottom: 0;
height: 30px;
width: 98.2%;
background-color: #1aa0e0;
color: white;
text-align: center;
margin-top: 10px;
border-top: 2px solid white;
border-left: 2px solid white;
border-right: 2px solid white;
border-top-right-radius: 5px;
border-top-left-radius: 5px;
font-size: 20px;

}

#ftext{
  font-family: sans-serif;
  margin-top: 5px;
}

#feed{
  margin-top: 5px;
  margin-left: 05px;
  background-color: #d9d9d9;
  height: 618px;
  width: 700px;
  border-radius: 20px;
  display: block;
  float: left;
  border: 4px solid #1aa0e0;
}

#utility{
  margin-top: 5px;
  margin-left: 05px;
  background-color: #d9d9d9;
  height: 618px;
  width: 500px;
  border-radius: 20px;
  display: block;
  float: right;
  border: 4px solid #1aa0e0;
}

#search{
  background-color: #1aa0e0;
  height: 40px;
  width: 600px;
  margin-top: 10px;
  margin-left: auto;
  margin-right: auto;
  display: block;
  border-radius: 20px;
}

#mags{
  margin-top: 0px;
  display: block;
  margin-left: 15px;
}

#usersearch{
  background-color: white;
  height: 30px;
  width: 520px;
  display: block;
  margin-top: -28px;
  border-radius: 20px;
  margin-left: 48px;
  color: black;
  font-size: 30px;

}

#ff{
  height: 482px;
  overflow: scroll;
  width: 700px;

}

#ff::-webkit-scrollbar {
    display: none;
}
body{

}

#post{

  height: 50px;
  width: 700px;
  background-color: #1aa0e0;
  display: block;
  border-bottom-left-radius: 16px;
  border-bottom-right-radius: 16px;


}

#postt{
  height: 50px;
  width: 500px;
  background-color: #1aa0e0;
  display: block;
  border-bottom-left-radius: 16px;
  border-bottom-right-radius: 16px;
margin-top: 545px;
}

#usertype{
  background-color: white;
  height: 30px;
  width: 520px;
  display: block;

  border-radius: 10px;
  margin-left: 48px;
  margin-top: -13px;
  color: black;
  font-size: 20px;
  float: left;


}

#usertypee{
  background-color: white;
  height: 30px;
  width: 380px;
  display: block;

  border-radius: 10px;
  margin-left: 10px;
  margin-top: -13px;
  color: black;
  font-size: 20px;
  float: left;
}
#typesend{
  display: block;
  background-color: white; /* Green */
border-style: 1px;
border-color: white;
color: #1aa0e0;
float: right;
padding: 5px 10px;
text-align: center;
text-decoration: none;
margin-right: 50px;

margin-top: -29px;
font-size: 20px;
font-family: sans-serif;
border-radius: 10px;
}

#typesendd{
  display: block;
  background-color: white; /* Green */
border-style: 1px;
border-color: white;
color: #1aa0e0;
float: right;
padding: 5px 10px;
text-align: center;
text-decoration: none;
margin-right: 20px;

margin-top: -34.5px;
font-size: 20px;
font-family: sans-serif;
border-radius: 10px;
margin-bottom: 0px;
}

.dropdown-content {
    display: none;
    position: absolute;
    background-color: #f1f1f1;
    min-width: 160px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;
}


#texttext{
  font-size: 20px;


}

#textdate{
  font-size: 25px;
  color: white;
  text-align: right;
  float: right;
  margin-right: 10px;
  margin-top: 14px;
}

#postname{
  font-size: 25px;
  margin-left: 40px;


}

#umenu{
  height: 30px;
  width: 500px;
  background-color:  #1aa0e0;
  border-top-left-radius: 16px;
    border-top-right-radius: 16px;
    color: white;
    word-spacing: 20px;
    font-size: 20px;
}

#uff{
  word-spacing: 1px;
  text-align: center;
  margin-top: 10px;
  color: black;
}


</style>
<script type="text/javascript">
  var table = document.getElementById("ff");

var unames = [];
var followcount = 1;
var pics = []
var userID;
var usname;
var picpicpic;
var otheruserID;
var oomessage;
function pagesetup(){
  var database = firebase.database();
      firebase.auth().onAuthStateChanged(function(user) {
        if (user) {

          // User is signed in.
        userID = firebase.auth().currentUser.uid;

        var trylq = firebase.database().ref().child(userID + '/name/');
        trylq.on('value', function(snapshot) {
          usname = snapshot.val();
          document.getElementById("username").innerHTML = usname;

        });

        var earningsq = firebase.database().ref().child(userID + '/pic/');
        earningsq.on('value', function(snapshot) {
          picpicpic = snapshot.val();



        });

        //  fillwindwow();
          newal();


        }
        else{
      //   window.location.href = "signin.htm";

       userID = "8FXxTwS2fwYveChBKNNIlStbQbu1";
       var trylq = firebase.database().ref().child(userID + '/name/');
       trylq.on('value', function(snapshot) {
         usname = snapshot.val();
         document.getElementById("username").innerHTML = usname;

       });

       var earningsq = firebase.database().ref().child(userID + '/pic/');
       earningsq.on('value', function(snapshot) {
         picpicpic = snapshot.val();



       });
      //  usname = "zNinee";
      //  picpicpic = "https://firebasestorage.googleapis.com/v0/b/poctest-c1a05.appspot.com/o/img_191958.png?alt=media&token=88088937-bbfe-43ad-8b7e-1e521579a758";

        //fillwindwow();
          newal();
        }
      })



}

function newal(){
    var database = firebase.database();
    var followerfill = [];

    var postfill = [];
    database.ref(userID + '/Following/').once('value', function(snap) {
      snap.forEach(function(item) {
        followerfill.push(item.val());
      })

      for(var x = 0 ; x < followerfill.length; x++)
        {
          database.ref(followerfill[x].ch + '/Myposts/').on('value', function(snap) {

            snap.forEach(function(item) {
              postfill.push(item.val());
            })

            setTimeout(function() { lololol(postfill); }, 30);




          });
        }

})




}


function lololol(postfill){
                var checkcheck = 0;
                var postfill = postfill;
                  document.getElementById("ff").innerHTML = "";
                  var posttable = document.createElement('table');

                  for(var i = 0; i < postfill.length; i++){
                    var row = posttable.insertRow(checkcheck);
                    row.style.backgroundColor = "#1aa0e0";
                    row.style.height = "100px";
                    row.style.width = "700px";
                    checkcheck++;
                    var cell1 = row.insertCell(0);
                    cell1.colspan = "2";
                    cell1.style.width = "700px";
                    cell1.style.height = "100px";
                    cell1.style.borderBottomLeftRadius = "0px";
                          cell1.style.borderBottomRightRadius = "0px";
                          cell1.style.borderTopLeftRadius = "25px";
                                cell1.style.borderTopRightRadius = "25px";
                      cell1.style.fontSize = "40px";
                      cell1.style.fontFamily = "sans-serif";
                      var img = document.createElement('img');
                      img.src = postfill[i].pic;
                      img.style.height = "100px";
                      img.style.width = "100px";
                      img.style.float = "left";
                      img.style.borderColor = "white";
                      img.style.borderWidth = "Thick";

                      var sspan = document.createElement('span');
                      sspan.innerHTML =  postfill[i].text;
                      sspan.style.fontSize = "10px";
                      sspan.style.color = "blue";
                      sspan.id = "textext";

                                    //cell1.style.textAlign = "center";
                    cell1.id = postfill[i].id;
                  //  cell1.onclick = function () {
                  //            tableText(this);
                    //      };

                                      var row2 = posttable.insertRow(checkcheck);
                                      checkcheck++;
                                        var cell2 = row2.insertCell(0);
                                      row2.style.height = "30px";
                                      row2.style.width = "700px";
                                      row2.style.backgroundColor = "#1aa0e0";
                                      cell2.style.width = "350px";
                                      cell2.style.height = "30px";
                                        cell2.style.borderBottomLeftRadius = "25px";
                                              cell2.style.borderBottomRightRadius = "25px";
                                              cell2.style.textAlign = "center";
                                              cell2.style.color = "white";
                                              cell2.style.textAlign = "center";
                                                cell2.onclick = function () {
                                                         goodluck(postfill[i]);
                                                      };
                                              cell2.innerHTML = '<span style="float: left; margin-left: 10px;" id="votes"> Votes: '+ postfill[i].votes + '</span><strong>Extend</strong>' + '<span style="float: Right; margin-right: 10px;" id="votes"> Comments: ' + postfill[i].comments+'  </span>';
                  cell1.appendChild(img);
                        cell1.innerHTML += "<strong>" + '<span id="postname"> ' + postfill[i].username + '</span>' + "</strong>" + "&nbsp&nbsp&nbsp" +'<span id="textdate">' + postfill[i].date + '</span>'+ "<br />" + '<span id="texttext">' + sspan.innerHTML + '</span>';
            //sspan.
                    var div = document.getElementById('ff');
                       div.appendChild(posttable);



  }

}


function fillwindwow(){
  var database = firebase.database();
var postfill = [];
  database.ref(userID + '/posts/').on('value',function(snap) {
      postfill = [];
              snap.forEach(function(item) {
              var droptop = item.val();
                postfill.push(droptop);
            })
            document.getElementById("ff").innerHTML = "";

             var tbl = document.createElement('table');
             var l = 0;
            for(var i = postfill.length -1; i > 0; i--){
var header = tbl.createTHead();


              var row = header.insertRow(l);
              row.style.backgroundColor = "#1aa0e0";
              row.style.height = "100px";
              row.style.width = "700px";
              l++

              var cell1 = row.insertCell(0);

              cell1.colspan = "2";
              cell1.style.width = "700px";
              cell1.style.height = "100px";
              cell1.style.borderBottomLeftRadius = "0px";
                    cell1.style.borderBottomRightRadius = "0px";
                    cell1.style.borderTopLeftRadius = "25px";
                          cell1.style.borderTopRightRadius = "25px";
                cell1.style.fontSize = "40px";
                cell1.style.fontFamily = "sans-serif";
                var img = document.createElement('img');
                img.src = postfill[i].pic;
                img.style.height = "100px";
                img.style.width = "100px";
                img.style.float = "left";
                img.style.borderColor = "white";
                img.style.borderWidth = "Thick";

                var sspan = document.createElement('span');
                sspan.innerHTML =  postfill[i].text;
                sspan.style.fontSize = "10px";
                sspan.style.color = "blue";
                sspan.id = "textext";

                              //cell1.style.textAlign = "center";
              cell1.id = postfill[i].id;
            //  cell1.onclick = function () {
            //            tableText(this);
              //      };



                                var row2 = header.insertRow(l);
                                l++;
                                  var cell2 = row2.insertCell(0);

                                row2.style.height = "30px";
                                row2.style.width = "700px";
                                row2.style.backgroundColor = "#1aa0e0";
                                cell2.style.width = "350px";
                                cell2.style.height = "30px";
                                  cell2.style.borderBottomLeftRadius = "25px";
                                        cell2.style.borderBottomRightRadius = "25px";
                                        cell2.style.textAlign = "center";
                                        cell2.style.color = "white";
                                        cell2.style.textAlign = "center";
                                          cell2.onclick = function () {
                                                   goodluck(postfill[i]);
                                                };
                                        cell2.innerHTML = '<span style="float: left; margin-left: 10px;" id="votes"> Votes: '+ postfill[i].votes + '</span><strong>Extend</strong>' + '<span style="float: Right; margin-right: 10px;" id="votes"> Comments: ' + postfill[i].comments+'  </span>';


            cell1.appendChild(img);
                  cell1.innerHTML += "<strong>" + '<span id="postname"> ' + postfill[i].username + '</span>' + "</strong>" + "&nbsp&nbsp&nbsp" +'<span id="textdate">' + postfill[i].date + '</span>'+ "<br />" + '<span id="texttext">' + sspan.innerHTML + '</span>';

//sspan.
              var div = document.getElementById('ff');
                 div.appendChild(tbl);



            }
          })

}

function goodluck(va){
  var database = firebase.database();
  document.getElementById("utility").innerHTML = "";



}

function searchscript(){

//  userID = firebase.auth().currentUser.uid;

var imgg = document.createElement('imgg');
  var firebaseref = firebase.database().ref();
  var database = firebase.database();
  var usertext = document.getElementById("usersearch").value;
  database.ref('/Users/').on('value',function(snap) {
      unames = [];
              snap.forEach(function(item) {

              var usernames = item.val();
              var length = usertext.length;
              var newuser = usernames.name.toString();
              var newnew = newuser.slice(0, length);
                if(usertext == "")
                {
                  unames = [];
                  location.reload();
                }
                else if(usertext.toLowerCase() == newnew.toLowerCase()){
                unames.push(usernames);


              }



            })
document.getElementById("ff").innerHTML = "";

 var tbl = document.createElement('table');
for(var i = 0; i < unames.length; i++){


  var row = tbl.insertRow(i);
  row.style.backgroundColor = "#1aa0e0";
  row.style.height = "50px";
  row.style.width = "600px";
  row.style.borderRadius = "25px";
  var cell1 = row.insertCell(0);

  cell1.style.width = "600px";
    cell1.style.borderRadius = "25px";
    cell1.style.fontSize = "40px";
    cell1.style.fontFamily = "sans-serif";
    var img = document.createElement('img');
    img.src = unames[i].pic;
    img.style.height = "50px";
    img.style.width = "50px";
    img.style.float = "left";
    img.style.borderColor = "white";
    img.style.borderWidth = "Thick";


  cell1.innerHTML = unames[i].name;
  cell1.style.textAlign = "center";
  cell1.id = unames[i].id;
  otheruserID = unames[i].id;
  cell1.onclick = function () {
            tableText(this);
        };

cell1.appendChild(img);
cell1.appendChild(imgg);
  var div = document.getElementById('ff');
     div.appendChild(tbl);


}

          })



        }



function tableText(tableCell) {
  //  alert(tableCell.id);

  document.getElementById('ff').innerHTML = "";
    var pic;
    var username;
    var xp;
    var trials;
    var followers;
    var following;
    var psn;
    var xbl;
    var earnings
    var twitter;
    var firebaseref = firebase.database().ref();
    var database = firebase.database();
    var psnlength;




        var picq = firebase.database().ref().child(tableCell.id + '/pic/');
        picq.on('value', function(snapshot) {
          pic = snapshot.val();
          var img = document.createElement('img');
          img.src = pic;
          img.style.height = "100px";
          img.style.width = "100px";
        //  img.style.marginLeft = "299px";
        //  img.style.marginRight = "auto";
          var div = document.getElementById('ff');
             div.appendChild(img);
        });

        var usernameq = firebase.database().ref().child(tableCell.id + '/name/');
        usernameq.on('value', function(snapshot) {
          username = snapshot.val();
           document.getElementById("ff").innerHTML += "<br />" + username;
           document.getElementById("ff").style.textAlign = "center";
            document.getElementById("ff").style.fontSize = "30px";
        });

        var xpq = firebase.database().ref().child(tableCell.id + '/xp/');
        xpq.on('value', function(snapshot) {
          xp = snapshot.val();
              document.getElementById("ff").innerHTML += "<br /> <br />XP: " + xp ;
        });

        var trylq = firebase.database().ref().child(tableCell.id + '/TryLs/');
        trylq.on('value', function(snapshot) {
          trials = snapshot.val();
          document.getElementById("ff").innerHTML += "&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTryLs: " + trials ;


        });

        var earningsq = firebase.database().ref().child(tableCell.id + '/Earnings/');
        earningsq.on('value', function(snapshot) {
          earnings = snapshot.val();
          document.getElementById("ff").innerHTML += "&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp Earnings: " + earnings;


        });



                var psnq = firebase.database().ref().child(tableCell.id + '/PSN/');
                psnq.on('value', function(snapshot) {
                  psn = snapshot.val();
                  document.getElementById("ff").innerHTML += "<br /><br /><br />";
                  var img = document.createElement('img');
                  img.src = "Images/psn.png";
                  img.style.height = "50px";
                  img.style.width = "50px";
                //  img.style.marginLeft = "299px";
                //  img.style.marginRight = "auto";
                  var div = document.getElementById('ff');

                  //   document.getElementById("ff").innerHTML += psn;
psnlength = psn.length;

if(psn == "")
{

}
else{
  div.appendChild(img);
   document.getElementById("ff").innerHTML += psn;

}

                });

                var xblq = firebase.database().ref().child(tableCell.id + '/XBL/');
                xblq.on('value', function(snapshot) {
                  xbl = snapshot.val();

                  document.getElementById("ff").innerHTML += "<br />";
                  var img = document.createElement('img');
                  img.src = "Images/xbl.png";
                  img.style.height = "50px";
                  img.style.width = "50px";
                //  img.style.marginLeft = "299px";
                //  img.style.marginRight = "auto";
                  var div = document.getElementById('ff');


                     if(xbl == "")
                     {

                     }
                     else{
                        document.getElementById("ff").innerHTML += xbl;
                         div.appendChild(img);
                     }




                });

                var tq = firebase.database().ref().child(tableCell.id + '/twitter/');
                tq.on('value', function(snapshot) {
                  twitter = snapshot.val();

                  document.getElementById("ff").innerHTML += "<br />";
                  var img = document.createElement('img');
                  img.src = "Images/twitter.png";
                  img.style.height = "50px";
                  img.style.width = "50px";
                //  img.style.marginLeft = "299px";
                //  img.style.marginRight = "auto";
                  var div = document.getElementById('ff');
                     if(twitter == "")
                     {
                     }
                     else{
                        div.appendChild(img);
                        document.getElementById("ff").innerHTML += twitter;
                     }
                });

                var array_name = [];
                database.ref(userID + "/Following/").once('value',function(snap) {
                  var check = false;
                                snap.forEach(function(item) {
                                var itemVal = item.val();
                                array_name.push(itemVal);
                                followcount++;

                              });

                              for(var i = 0; i < array_name.length; i++)
                              {
                                if(array_name[i].ch == tableCell.id)
                                {
                                  check = true;
                                }
                              }

                              if(check == true)
                              {
                                var tbl = document.createElement('table');
                                  var row = tbl.insertRow(0);
                                      var cell11 = row.insertCell(0);



                                      row.style.backgroundColor = "#1aa0e0";
                                      row.style.height = "50px";
                                      row.style.width = "600px";
                                      row.style.borderRadius = "25px";


                                            cell11.innerHTML = "UnFollow";
                                            cell11.style.textAlign = "center";
                                            cell11.style.backgroundColor = "grey";
                                            cell11.style.height="50px;"
                                            cell11.style.width="150px;"
                                            cell11.id = otheruserID;
                                            cell11.onclick = function () {
                                                      Unfollow(this);
                                                  };


                                            var div = document.getElementById('ff');
                                               div.appendChild(tbl);
                              }
                              else{
                                var tblee = document.createElement('table');
                                  var row = tblee.insertRow(0);
                                      var cel = row.insertCell(0);



                                      row.style.backgroundColor = "#1aa0e0";
                                      row.style.height = "50px";
                                      row.style.width = "600px";
                                      row.style.borderRadius = "25px";


                                            cel.innerHTML = "Follow";
                                            cel.style.textAlign = "center";
                                            cel.style.backgroundColor = "grey";
                                            cel.style.height="50px;"
                                            cel.style.width="150px;"
                                            cel.id = otheruserID;

                                            cel.onclick = function () {
                                                      follow(cel.id);
                                                  };


                                            var div = document.getElementById('ff');
                                               div.appendChild(tblee);

                              }

                            })













}

function follow(tableText){

var ch = tableText;
  firebase.database().ref(userID + '/Following/' + tableText).update({ch});
  firebase.database().ref(tableText + '/Followers/' + userID).update({ch});
  document.getElementById(otheruserID).innerHTML = "UnFollow";

//  database.ref(userID + '/userpost/').on('value',function(snap) {

        //      snap.forEach(function(item) {

            //  })})





}

function Unfollow(tableText){
var ch = tableText.id;
firebase.database().ref(userID + '/Following/' + tableText.id).remove();

firebase.database().ref(tableText.id + '/Followers/' + userID).remove();
  document.getElementById(otheruserID).innerHTML = "Follow";





}
function al(){
  alert("lol");
}
function signout(){
  firebase.auth().signOut().then(function() {
     window.location.href = "signin.htm";
  console.log('Signed Out');
}, function(error) {
  console.error('Sign Out Error', error);
});
}

function monthscript(month){
  var trolo = month + 1;
  switch(trolo){
              case 1:
                  return "January";
                  break;
              case 2:
                  return "February";
                  break;
              case 3:
                  return "March";
                  break;
              case 4:
                  return "April";
                  break;
              case 5:
                return "May";
                  break;
              case 6:
                  return "June";
                  break;
              case 7:
                  return "July";
                  break;
              case 8:
                  return "August";
                  break;
              case 9:
                  return "September";
                  break;
              case 10:
                  return "October";
                  break;
              case 11:
                  return "November";
                  break;
              case 12:
                  return "December";
                  break;
              default:
                  monthName = "Invalid month";
                  break;


  }
}
function postmessage(){
  var usermessage = document.getElementById("usertype").value;
  document.getElementById("usertype").value = "";

  var firebaseref = firebase.database().ref();
  var database = firebase.database();
  var d = new Date();
  var year = d.getFullYear();
  var month = d.getMonth();
  var date = d.getDate();
  var hours = d.getHours();
  var minutes = d.getMinutes();
  var datte;

//var last2 = year.slice(-2);
//var last2 = year.toString().substr(year.length -2);
var last2 = year.toString().slice(-2);
if(hours > 11)
{
//   datte = monthscript(month) + " " + date + " " + year + " " + hours + ":" + minutes + "pm";

   datte = hours - 12 + ":" + minutes + " " + "pm" +  " " + monthscript(month) + " " + date + " '" + last2 + " ";
}
else{
     datte = hours + ":" + minutes + "am"  + " " + monthscript(month) + " " + date + " '" + last2 + " ";
}

var sizecheck = usermessage.toLowerCase().search("font-size:");
var buttoncheck = usermessage.toLowerCase().search("</button>");


if(sizecheck != -1){
  alert("You can not change the size of your font. Use <Strong> to bold :)");

}
else if(buttoncheck != -1){
  alert("You can not add buttons. Use <a> to link :)");
}
else{


              var data =
              {
                username: usname,
                userid: userID,
                text: usermessage,
                pic: picpicpic,
                date: datte,
                votes: 0,

                comments: 0,


              }

//var newPostKey = firebase.database().ref().child(stupid.otheruserID + '/posts/').push().key;
//var userkey = firebase.database().ref().child(userID + '/posts/').push().key;
var newuserkey = firebase.database().ref().child(userID + '/Myposts/').push().key;



var updates = {};

//  updates[stupid.otheruserID + '/posts/' + newPostKey] = data;
//  updates[userID + '/posts/' + newPostKey] = data;
  updates[userID + '/Myposts/' + newuserkey] = data;

return firebase.database().ref().update(updates);






}

location.reload();
}

function uploadd(){
  var firebaseref = firebase.database().ref();
  var database = firebase.database();
  var input = document.createElement("input");

  input.type = 'file';
  input.click();
  input.id = "idk";
  const ref = firebase.storage().ref();



const file = document.getElementById(input).files[0];
const name = (+new Date()) + '-' + file.name;
const metadata = {
  contentType: file.type
};
const task = ref.child(name).put(file, metadata);
var url;
task.then((snapshot) => {
   url = snapshot.downloadURL;

}).catch((error) => {
  console.error(error);
  alert("Error");
});

var pid;
task.then((snapshot) => {
    pid = snapshot.downloadURL;
});

firebase.database().ref(userID).update({

 pic: url,
});

firebase.database().ref("Users/" + userID).update({

 pic: url,
});

username();




}

function username(){

  document.getElementById('ff').innerHTML = "";
    var pic;
    var username;
    var xp;
    var trials;
    var followers;
    var following;
    var psn;
    var xbl;
    var earnings
    var twitter;
    var role;
    var fa;
    var firebaseref = firebase.database().ref();
    var database = firebase.database();
    var psnlength;
    var pn = document.createElement("INPUT");
    var xl = document.createElement("INPUT");
    var twi = document.createElement("INPUT");
    var ro = document.createElement("INPUT");
    //userID = firebase.auth().currentUser.uid;



        var picq = firebase.database().ref().child(userID + '/pic/');
        picq.once('value', function(snapshot) {
          pic = snapshot.val();
          var img = document.createElement('img');
          img.src = pic;
          img.style.height = "100px";
          img.style.width = "100px";
        //  img.style.marginLeft = "299px";
        //  img.style.marginRight = "auto";
          var div = document.getElementById('ff');
             div.appendChild(img);
        });

        var usernameq = firebase.database().ref().child(userID + '/name/');
        usernameq.once('value', function(snapshot) {
          username = snapshot.val();
           document.getElementById("ff").innerHTML += "<br />" + username;
           document.getElementById("ff").style.textAlign = "center";
            document.getElementById("ff").style.fontSize = "30px";
        });

        var xpq = firebase.database().ref().child(userID + '/xp/');
        xpq.once('value', function(snapshot) {
          xp = snapshot.val();
            //  document.getElementById("ff").innerHTML += "<br /> <br />XP: " + xp ;
        });

        var trylq = firebase.database().ref().child(userID + '/TryLs/');
        trylq.once('value', function(snapshot) {
          trials = snapshot.val();
        //  document.getElementById("ff").innerHTML += "&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTryLs: " + trials ;


        });

        var earningsq = firebase.database().ref().child(userID + '/Earnings/');
        earningsq.once('value', function(snapshot) {
          earnings = snapshot.val();
        //  document.getElementById("ff").innerHTML += "&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp Earnings: " + earnings;


        });

        var r = firebase.database().ref().child(userID + '/Role/');
        r.once('value', function(snapshot) {
          Role = snapshot.val();
        // document.getElementById("ff").innerHTML += "&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp Earnings: " + earnings;

ro.id = "ro";
          ro.type = "text";//("type", "text");
          ro.placeholder = Role;//("placeholder", twitter);

document.getElementById("ff").innerHTML += "<br /> Role: ";
          document.getElementById("ff").appendChild(ro);



        });



                var psnq = firebase.database().ref().child(userID + '/PSN/');
                psnq.once('value', function(snapshot) {
                  psn = snapshot.val();
                  document.getElementById("ff").innerHTML += "<br />";
                  var img = document.createElement('img');
                  img.src = "Images/psn.png";
                  img.style.height = "50px";
                  img.style.width = "50px";
                //  img.style.marginLeft = "299px";
                //  img.style.marginRight = "auto";
                  var div = document.getElementById('ff');

                  //   document.getElementById("ff").innerHTML += psn;


var div = document.getElementById('ff');



pn.type = "text";//("type", "text");
pn.placeholder = psn;//("placeholder", twitter);
pn.id = "pn";
document.getElementById("ff").innerHTML += "PSN: ";
//div.appendChild(img);
document.getElementById("ff").appendChild(pn);

                });

                var xblq = firebase.database().ref().child(userID + '/XBL/');
                xblq.on('value', function(snapshot) {
                  xbl = snapshot.val();

                  document.getElementById("ff").innerHTML += "<br /> XBL: ";
                  var img = document.createElement('img');
                  img.src = "Images/xbl.png";
                  img.style.height = "50px";
                  img.style.width = "50px";
                //  img.style.marginLeft = "299px";
                //  img.style.marginRight = "auto";
                  var div = document.getElementById('ff');



                  xl.type = "text";//("type", "text");
                  xl.placeholder = xbl;//("placeholder", twitter);
xl.id = "xl";
                //  div.appendChild(img);
                  document.getElementById("ff").appendChild(xl);






                });

                var tq = firebase.database().ref().child(userID + '/twitter/');
                tq.once('value', function(snapshot) {
                  twitter = snapshot.val();

                  document.getElementById("ff").innerHTML += "<br /> Twitter: ";
                  var img = document.createElement('img');
                  img.src = "Images/twitter.png";
                  img.style.height = "50px";
                  img.style.width = "50px";
                //  img.style.marginLeft = "299px";
                //  img.style.marginRight = "auto";
                  var div = document.getElementById('ff');

                       twi.type = "text";//("type", "text");
                       twi.placeholder = twitter;//("placeholder", twitter);
twi.id = "twi";
                    //   div.appendChild(img);
                       document.getElementById("ff").appendChild(twi);
                       document.getElementById("ff").innerHTML += "<br />";
                       var newButton = document.createElement('input');
                               newButton.type = 'button';
                               newButton.value = "Update All";
                             //  newButton.id = buttonsToCreate[i];
                               newButton.onclick = function () {

var newpsn = document.getElementById("pn").value;
var newxbl = document.getElementById("xl").value;
var newtwit = document.getElementById("twi").value;
var newrole = document.getElementById("ro").value;

if(newpsn == "")
{
  newpsn = "psn";
}

if(newxbl == "")
{
  newxbl = "xbl";
}
if(newtwit == "")
{
  newtwit = "twitter";
}
if(newrole == "")
{
newrole = "Role";
}
                                 firebase.database().ref(userID).update({

                                  XBL: newxbl,
                                  PSN: newpsn,
                                  twitter: newtwit,
                                  Role: newrole,
                                });


                               };
                         document.getElementById("ff").appendChild(newButton);

                         var newButtonn = document.createElement('input');
                                 newButtonn.type = 'button';
                                 newButtonn.value = "Change Pic";
                               //  newButton.id = buttonsToCreate[i];
                                 newButtonn.onclick = function () {
                                   uploadd();

                                 }

                         document.getElementById("ff").innerHTML += "<br />";//(newButton);
                              document.getElementById("ff").appendChild(newButtonn);





                });



                //var element = document.createElement("input");
  //Assign different attributes to the element.

//  element.value = "Update All"; // Really? You want the default value to be the type string?
  //element.name = "update"; // And the name too?
//  element.onclick = function() { // Note this is a function
//  alert("hi");
//  };






//Append the element in page (in span).








}

function cc(){


  document.getElementById("uff").innerHTML = "";
  var posttable = document.createElement('table');




    var row = posttable.insertRow(0);
    row.style.backgroundColor = "#1aa0e0";
    row.style.height = "50px";
    row.style.width = "600px";
    row.style.borderRadius = "25px";
    var cell1 = row.insertCell(0);

    cell1.style.width = "600px";
      cell1.style.borderRadius = "25px";
      cell1.style.fontSize = "40px";
      cell1.style.fontFamily = "sans-serif";



    cell1.innerHTML = "NGE NA Ladder";
    cell1.style.textAlign = "center";

    cell1.onclick = function () {
              ladder();
          };


          var row2 = posttable.insertRow(1);
          row2.style.backgroundColor = "#1aa0e0";
          row2.style.height = "50px";
          row2.style.width = "600px";
          row2.style.borderRadius = "25px";
          document.getElementById('uff').innerHTML += "<br />";
          var cell2 = row.insertCell(1);

          cell2.style.width = "600px";
            cell2.style.borderRadius = "25px";
            cell2.style.fontSize = "40px";
            cell2.style.fontFamily = "sans-serif";



          cell2.innerHTML = "Team Scrims";
          cell2.style.textAlign = "center";

          cell2.onclick = function () {
                    tscrim();
                };

    var div = document.getElementById('uff');
       div.appendChild(posttable);


  }
function tscrim(){
  document.getElementById("uff").innerHTML = 'Click any of the below to accept or click <button onclick="createts()"> here </button> to be added';

  var tss = [];

  var database = firebase.database();
  database.ref('/TSF/').once('value', function(snap) {
    var fa = [];
    snap.forEach(function(item) {


      tss.unshift(item.val());
    })


      var fatable = document.createElement('table');
      for(var i = 0; i < tss.length; i++){
        if(tss[i].userid == userID)
        {

                    var row = fatable.insertRow(i);
                    row.style.backgroundColor = "#ff9999";

                    row.style.height = "100px";
                    row.style.width = "700px";
                    var cell1 = row.insertCell(0);
                    cell1.colspan = "2";
                    cell1.style.width = "700px";
                    cell1.style.height = "100px";
                    cell1.style.borderRadius = "20px";
                    cell1.innerHTML = tss[i].name;

                    cell1.onclick = function () {
                      var firebaseref = firebase.database().ref();

                    firebase.database().ref.child('TSF/' + tss[i].ke).remove();
                          };
        }
        else{

                    var row = fatable.insertRow(i);
                    row.style.backgroundColor = "#1aa0e0";
                    row.style.height = "100px";
                    row.style.width = "700px";
                    var cell1 = row.insertCell(0);
                    cell1.colspan = "2";
                    cell1.style.width = "700px";
                    cell1.style.height = "100px";
                    cell1.style.borderRadius = "20px";
                      cell1.innerHTML = tss[i].name;
                      cell1.onclick = function () {
                          var firebaseref = firebase.database().ref();
                        firebase.database().ref.child('TSF/' + tss[i].ke).remove();
                                run(tss[i].userid);
                            };

        }

      }
      var div = document.getElementById('uff');
         div.appendChild(fatable);
    })

  }

function run(t){
  var i = t;
  var database = firebase.database();
  var me = [];
  oomessage = i;
  //var newuserkey = firebase.database().ref().child('/Messages/' + t + '/' + userID).push().key;
    //var otheruserkey = firebase.database().ref().child('/Messages/' + userID + '/' + t).push().key;
    database.ref('/Messages/' + userID + '/' + i).on('value', function(snap) {

      snap.forEach(function(item) {
        me.push(item.val());
      })


    });

    var checkcheck = 0;
    var postfill = me;
      document.getElementById("uff").innerHTML = "";
      var posttable = document.createElement('table');
      for(var i = 0; i < postfill.length; i++){
        var row = posttable.insertRow(checkcheck);
        row.style.backgroundColor = "#1aa0e0";
        row.style.height = "100px";
        row.style.width = "700px";
        checkcheck++;
        var cell1 = row.insertCell(0);
        cell1.colspan = "2";
        cell1.style.width = "700px";
        cell1.style.height = "100px";
        cell1.style.borderBottomLeftRadius = "0px";
              cell1.style.borderBottomRightRadius = "0px";
              cell1.style.borderTopLeftRadius = "25px";
                    cell1.style.borderTopRightRadius = "25px";
          cell1.style.fontSize = "40px";
          cell1.style.fontFamily = "sans-serif";
          cell1.innerHTML = postfill[i].message;

        var div = document.getElementById('uff');
           div.appendChild(posttable);

}


}


function createts(){
var database = firebase.database();

var newuserkey = firebase.database().ref().child('/TSF/').push().key;





//  updates[stupid.otheruserID + '/posts/' + newPostKey] = data;
//  updates[userID + '/posts/' + newPostKey] = data;
firebase.database().ref('TSF/' + newuserkey).set({
name: usname,
userid: userID,
ke: newuserkey,

});




}




function ladder(){

}






function sendmessage(){
  var usermessage = document.getElementById("usertypee").value;
  document.getElementById("usertypee").value = "";

  var firebaseref = firebase.database().ref();
  var database = firebase.database();


//var last2 = year.slice(-2);
//var last2 = year.toString().substr(year.length -2);


var sizecheck = usermessage.toLowerCase().search("font-size:");
var buttoncheck = usermessage.toLowerCase().search("</button>");


if(sizecheck != -1){
  alert("You can not change the size of your font. Use <Strong> to bold :)");

}
else if(buttoncheck != -1){
  alert("You can not add buttons. Use <a> to link :)");
}
else{


              var data =
              {
                username: usname,
                userid: userID,
                text: usermessage,

              }

//var newPostKey = firebase.database().ref().child(stupid.otheruserID + '/posts/').push().key;
//var userkey = firebase.database().ref().child(userID + '/posts/').push().key;
var newuserkey = firebase.database().ref().child('/Messages/' + userID + '/' + oomessage).push().key;
var other = firebase.database().ref().child('/Messages/' + oomessage + '/' + userID).push().key;



var updates = {};
var u = {};
//  updates[stupid.otheruserID + '/posts/' + newPostKey] = data;
//  updates[userID + '/posts/' + newPostKey] = data;
  updates['/Messages/' + userID + '/' + oomessage + '/' + newuserkey] = data;
    updates['/Messages/' + oomessage + '/' + userID + '/' + other] = data;

return firebase.database().ref().update(updates);
return firebase.database().ref().update(u);





}



}
</script>


</head>
<body onload="pagesetup();">
<div id="head">
  <div id="username" onclick="username();">

  Username


  </div>

<center>

  <a href="index.htm">  <img id="headerlogo" src="Images/ngelogo.png" height="110px" width="110px" /></a>

</center>

<div id="menu">
  <img  src="Images/feed.png" height="40px" width="40px" />
  &nbsp&nbsp
  <img src="Images/alert.png" height="40px" width="40px" />
    &nbsp&nbsp
  <img  src="Images/message.png" height="40px" width="40px" />
    &nbsp&nbsp
  <img src="Images/shop.png" height="40px" width="40px" />
    &nbsp&nbsp
  <button onclick="signout();"><img  src="Images/signout.png" height="40px" width="40px" /></button>
</div>

</div>

<div id="feed">
  <div id="search">
    <img id="mags" src="Images/mag.png" height="30px" width="30px" />

      <input onkeyup="searchscript()" id ="usersearch" placeholder=""> <br />


  </div>
<br /><br />
  <div id="ff">

  <table id="myTable">


  </table>
  </div>
  <div id="post">
    <br />
    <input onkeyup="" id ="usertype" placeholder=""> <br />
    <button onclick="postmessage();" id="typesend"> Send </button>
  </div>

</div>

<div id="utility">
  <div id="umenu">
    <center>
    <span onclick="cc();">Competetion </span> &nbsp&nbsp&nbsp  Comunity &nbsp&nbsp&nbsp News
  </center>
  <div id="uff">

  </div>
  <div id="postt">
    <br />
    <input onkeyup="" id ="usertypee" placeholder=""> <br />
    <button onclick="sendmessage();" id="typesendd"> Send </button>
  </div>

  </div>


</div>
<div id="footer">
  <div id="ftext">
  Privacy Policy &nbsp&nbsp&nbsp
  Terms of Service &nbsp&nbsp&nbsp
  Advertise &nbsp&nbsp&nbsp
  Contact Us
</div>


</div>
  <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyCQtXd25fQmP_6zV-mxSs64O_9y2J20iI4",
      authDomain: "poctest-c1a05.firebaseapp.com",
      databaseURL: "https://poctest-c1a05.firebaseio.com",
      projectId: "poctest-c1a05",
      storageBucket: "poctest-c1a05.appspot.com",
      messagingSenderId: "434071952145"
    };
    firebase.initializeApp(config);
    </script>
</body>


</html>
